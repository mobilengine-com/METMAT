<form id='badtestcaselist' menuName='Bad test cases' platforms="web" xmlns="http://schemas.mobilengine.com/fls/v2">

	<declarations>
		<let id='user_proj' shape='scalar' value='{
        loadNewerFromServer:SELECT us.active_project 
        FROM userState us INNER JOIN tester t ON us.tester_name = t.tester_name
        WHERE t.tester_email = sysp.user}'/>
		<let id='currentVersion' shape='scalar' value='{SELECT v.version FROM versions v WHERE v.current = 1 AND v.project = user_proj}' />
	</declarations>	

	<table id='badtclist' record='badtc' recordset='{loadNewerFromServer:select tl.tc_id, tl.last_status, tl.note from tc_list tl where tl.last_status="bad test case" AND tl.mainVersion = currentVersion AND tl.project = user_proj group by tl.tc_id}'>
			<header>
				<row>
					<cell>
						<textview text='Task Id'/>
					</cell>
					<cell>
						<textview text='Result'/>
					</cell>
					<cell>
						<textview text='Note'/>
					</cell>
					<cell>
						<textview text=''/>
					</cell>				
				</row>           
			</header>
			<row>				
				<cell>
					<textview id='task_id' text='{badtc.tc_id}'/>
				</cell>
				<cell>
					<textview id='result' text='{badtc.last_status}'/>
				</cell>
				<cell>
					<textview id='note' text='{badtc.note}'/>
				</cell>
				<cell>
					<submitbutton id="fixSubmit" text="Fixed" closeForm="{false}"></submitbutton>
				</cell>
				<cell>
					<if cond='{(SELECT Count(tc.TestId) FROM manualTests tc WHERE tc.TestId = task_id.text) > 0}'>
						<discardbutton text='Go to manual test' id="totestWrite" nextForm='{forms.manualTestWriter}'> 
                        <params>
                            <param id='test_Id' value='{task_id.text}'/>
							<param id='edit' value='{"1"}'/>
                            <param id='fromForm' value='{"badtestcaselist"}'/>
                        </params>
                    </discardbutton>
					</if>
					<if cond='{(SELECT Count(tc.TestId) FROM manualTests tc WHERE tc.TestId = task_id.text) = 0}'>
                    	<linkview id='tcLink' url="{SELECT tc.link FROM test_case tc WHERE tc.id = task_id.text Limit 1}" text=" Go to link"/>
                	</if>
				</cell>						
			</row>
		</table>
</form>